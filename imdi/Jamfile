# JAM style makefile for integer interpolation code, cctiff etc.

#SubDir TOP imdi ;

CCFLAGS 	+= $(CCOPTFLAG) ;		# Turn optimisation on
#CCFLAGS	    += $(CCDEBUGFLAG) ;		# Debugging flags
#CCFLAGS 	+= $(CCPROFFLAG) ;		# Profile flags
LINKFLAGS	+= $(LINKDEBUGFLAG) ;	# Link debugging flags
#LINKFLAGS	+= $(LINKPROFFLAG) ;    # Profile flags
#CCFLAGS	+= $(CCHEAPDEBUG) ;		# Heap Debugging flags

if $(HAVE_TIFF) {	# Alternate TIFF library
	TIFFLIB = ;
	TIFFINC = ;
	LINKLIBS on cctiff$(SUFEXE) = -ltiff $(LINKLIBS) ;
} else {
	TIFFLIB = ../tiff/libtiff.lib ;
	TIFFINC = ../tiff ;
}

#Products
Libraries = libimdi ;
Executables = cctiff greytiff ;
Headers = imdi.h ;

#Install
InstallBin $(DOTDOT)$(SLASH)bin : $(Executables)$(SUFEXE) ;
#InstallFile $(DOTDOT)$(SLASH)h : $(Headers) ;
#InstallLib $(DOTDOT)$(SLASH)lib : $(Libraries)$(SUFLIB) ;

# imdi low level cgen test code
Main ctest : ctest.c cgen.c ;

# make imdi code program
Main imdi_make : imdi_make.c imdi_gen.c cgen.c ;
ObjectHdrs imdi_make imdi_gen.c cgen.c : ../h ;

# GenFile source.c : program args ;	make custom file
# Generate all the kernel files
GenFile imdi_k.h : imdi_make ;

# imdi library
Library libimdi.lib : imdi.c imdi_tab.c ;
ObjectHdrs imdi_tab$(SUFOBJ) : ../h ../numlib ;

# imdi test code
Main itest : itest.c refi.c ;
ObjectHdrs itest$(SUFOBJ) refi$(SUFOBJ) : ../h ../rspl ../numlib ;	# icc bug workaround
LinkLibraries itest : libimdi.lib ../rspl/librspl.lib ../numlib/libnum.lib ;

# TIFF file color correction utlity
Main cctiff : cctiff.c ;
ObjectHdrs cctiff$(SUFOBJ) : ../h ../xicc ../numlib ../icc ../rspl
                              $(TIFFINC) ;
LinkLibraries cctiff : ../xicc/libxutils.lib ../rspl/librspl.lib
                       ../icc/libicc.lib ../numlib/libnum.lib
                        $(TIFFLIB) libimdi.lib ;

# Old TIFF file color correction utlity
Main cctiffo : cctiffo.c ;
ObjectHdrs cctiffo$(SUFOBJ) : ../h ../icc $(TIFFINC) ;
LinkLibraries cctiffo : ../icc/libicc.lib $(TIFFLIB) libimdi.lib ;

# TIFF file monochrome conversion utlity
Main greytiff : greytiff.c ;
ObjectHdrs greytiff$(SUFOBJ) : ../h ../numlib ../icc ../rspl ../xicc
                              ../spectro ../gamut ../cgats $(TIFFINC) ;
LinkLibraries greytiff : ../xicc/libxicc.lib
                        ../gamut/libgamut.lib ../cgats/libcgats.lib
                        ../rspl/librspl.lib ../icc/libicc.lib 
                        ../plot/libplot.lib ../numlib/libnum.lib
                        $(TIFFLIB) libimdi.lib ;


# ssort generation code
#Main ssort : ssort.c ;

#Main shsort : shsort.c ;
#ObjectHdrs shsort$(SUFOBJ) : ../h ../numlib ;
#LinkLibraries shsort : ../numlib/libnum.lib ;

# code generated by shsort
#Main ttt : ttt.c ;
#ObjectHdrs ttt$(SUFOBJ) : ../h ../numlib ;
#LinkLibraries ttt : ../numlib/libnum.lib ;

if $(BUILD_JUNK) {

	CCFLAGS 	+= -msse3 ;

	Main tvec : tvec.c ;
	Main tvec2 : tvec2.c ;

	# test code
	Main tsort : tsort.c ;
	ObjectHdrs tsort$(SUFOBJ) : ../h ../numlib ;
	LinkLibraries tsort : ../numlib/libnum.h ;
}

