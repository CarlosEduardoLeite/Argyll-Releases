
# This holds the common definitions for Argyll that all the
# subdirectory jam's will include (even if run in the sub directory) 

Echo "Argyll Jamrules has been read" ;


# Default install base directory is same directory as Jamtop,
# but can be overriden in the command line.
DESTDIR ?= [ NormPaths  . ] ;

# Default prefix is empty, but can be overriden in the command line.
PREFIX ?= "" ;

# Default ref file sub-directory is "ref", but can be overriden in the command line.
REFSUBDIR ?= "ref" ;

Echo "DESTDIR = '$(DESTDIR)', PREFIX = '$(PREFIX)', REFSUBDIR = '$(REFSUBDIR)'" ;

# Keep this DESTDIR anchored to Jamtop. PREFIX is used literally
ANCHORED_PATH_VARS = DESTDIR ;


# Tell standalone libraries that they are part of Argyll:
DEFINES += ARGYLLCMS ;

# Use libusb1 rather than libusb0 & libusb0-win32
USE_LIBUSB1 = true ;

# Except that FreeBSD doesn't have libusb1 port yet..
if $(OS) = FREEBSD || $(OS) = OPENBSD {
	USE_LIBUSB1 = false ; # Use libusb 0.1
}

# Make the USB V1 library static
LIBUSB_IS_DLL = false ;

# Always use DLL for MSWin, because driver install expects it (.inf)
if $(NT) {
	LIBUSB_IS_DLL = true ;
}

# Set the libubs1 library name.
LIBUSB1NAME = libusb-1.0A ;

# Information for compiling and linking GUI programs

if $(UNIX) {
	if $(OS) = MACOSX {
		LINKFLAGS += -framework IOKit ;
		LINKFLAGS += -framework CoreFoundation ;

	} else {
		if [ GLOB /usr/X11R6/include/X11 : X.h ] {
			LibWinH = /usr/X11R6/include ;
			LibWinD = /usr/X11R6/lib ;
		} else if [ GLOB /usr/include/X11 : X.h ] {
			LibWinH = /usr/include ;
			if $(HOST64) {
				LibWinD = /usr/lib64 ;
			} else {
				LibWinD = /usr/lib ;
			}
		} else {
			EXIT Unable to locate the X11 include files ;
		}
		if $(OS) = FREEBSD {
			LINKFLAGS += -L$(LibWinD) -g -lrt -lX11 -lXext -lXxf86vm -lXinerama -lXrandr -lXau -lXdmcp -lXss  -lusb ;
		} else {
			LINKFLAGS += -L$(LibWinD) -ldl -lrt -lX11 -lXext -lXxf86vm -lXinerama -lXrandr -lXau -lXdmcp -lXss ;
		}
		# HDRS += $(LibWinH) ; 
	}
}

# See if we have a system TIFF library.
if ! $(BUILTIN_TIFF) && $(UNIX) {
	if [ GLOB /usr/include : tiffio.h ]  {
		if  [ GLOB /usr/lib : libtiff.so ] 
		 || [ GLOB /usr/lib : libtiff.a ]  {
			echo "Using system TIFF library" ;
			TIFFLIB = ;
			TIFFINC = ;
			LINKFLAGS += $(LINKFLAG)tiff ;
			HAVE_TIFF = true ;
		}
	}
}

# If nothing else, use Argyll supplied TIFF library
if ! $(HAVE_TIFF) || $(BUILTIN_TIFF) {
	echo "Using built in TIFF library" ;
	TIFFLIB = ../tiff/libtiff.lib ;
#	TIFFINC = ../tiff ../tiff/libtiff ;
	TIFFINC = ../tiff ;
}

# testing
#DSTDIR = var ;
#SRCDIR = .. ;
